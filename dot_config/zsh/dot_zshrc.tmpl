{{ if (eq .zsh.prompt "starship") }}# -*- mode: sh -*-
if command -v starship &> /dev/null; then
   eval "$(starship init zsh)"
fi
{{ else if (eq .zsh.prompt "p10k") }}
# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r {{ joinPath .xdg.cache "/p10k-instant-prompt-${(%):-%n}.zsh" | quote }} ]]; then
   source  {{ joinPath .xdg.cache "/p10k-instant-prompt-${(%):-%n}.zsh" | quote }}
fi
{{ end }}
HISTFILE=~/.cache/histfile
HISTSIZE=10000
SAVEHIST=10000

## Keybindings section
bindkey -e
bindkey '^[[7~' beginning-of-line                               # Home key
bindkey '^[[H' beginning-of-line                                # Home key
if [[ "${terminfo[khome]}" != "" ]]; then
  bindkey "${terminfo[khome]}" beginning-of-line                # [Home] - Go to beginning of line
fi
bindkey '^[[8~' end-of-line                                     # End key
bindkey '^[[F' end-of-line                                     # End key
if [[ "${terminfo[kend]}" != "" ]]; then
  bindkey "${terminfo[kend]}" end-of-line                       # [End] - Go to end of line
fi
bindkey '^[[2~' overwrite-mode                                  # Insert key
bindkey '^[[3~' delete-char                                     # Delete key
bindkey '^[[C'  forward-char                                    # Right key
bindkey '^[[D'  backward-char                                   # Left key
bindkey '^[[5~' history-beginning-search-backward               # Page up key
bindkey '^[[6~' history-beginning-search-forward                # Page down key

# Navigate words with ctrl+arrow keys
bindkey '^[Oc' forward-word                                     #
bindkey '^[Od' backward-word                                    #
bindkey '^[[1;5D' backward-word                                 #
bindkey '^[[1;5C' forward-word                                  #
bindkey '^H' backward-kill-word                                 # delete previous word with ctrl+backspace
bindkey '^[[Z' undo                                             # Shift+tab undo last action

ZINIT_HOME={{ joinPath .xdg.data "/zinit" | quote }}
source "${ZINIT_HOME}/zinit.git/zinit.zsh"

autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit


# Load a few important annexes, without Turbo
# (this is currently required for annexes)
zinit light-mode for \
    zdharma-continuum/zinit-annex-as-monitor \
    zdharma-continuum/zinit-annex-bin-gem-node \
    zdharma-continuum/zinit-annex-patch-dl \
    zdharma-continuum/zinit-annex-rust

### End of Zinit's installer chunk

{{ if (eq .zsh.prompt "starship") }}
zinit ice as"command" from"gh-r" \
   atclone"./starship init zsh > init.zsh; ./starship completions zsh > _starship" \
   atpull"%atclone" src"init.zsh"
zinit light starship/starship
{{ else if (eq .zsh.prompt "p10k") }}
zinit ice depth=1
zinit light romkatv/powerlevel10k

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f {{ joinPath .xdg.config "/zsh/.p10k.zsh" | quote }} ]] || source {{ joinPath .xdg.config "/zsh/.p10k.zsh" | quote }}
{{ end }}

zinit light zdharma-continuum/history-search-multi-word
zinit light zdharma-continuum/fast-syntax-highlighting
zinit light zsh-users/zsh-autosuggestions
zplugin light "zdharma-continuum/zsh-diff-so-fancy"

zinit ice wait lucid
zinit light olets/zsh-abbr

zinit ice blockf atpull'zinit creinstall -q .'
zinit light zsh-users/zsh-completions

zinit light RobSis/zsh-completion-generator
zstyle :plugin:zsh-completion-generator programs aspell emacs ggrep tr cat legendary

zinit ice from"gh-r" as"program" mv"docker* -> docker-compose" bpick"*linux*"
zinit light docker/compose

zinit ice \
    as"completion" \
    id-as"kubectl-completion" \
    has"kubectl" \
    atclone"kubectl completion zsh > _kubectl" \
    atpull"%atclone" \
    nocompile
zinit light zdharma-continuum/null

zinit as"null" wait"1" lucid for \
    sbin    Fakerr/git-recall \
    sbin    cloneopts paulirish/git-open \
    sbin    paulirish/git-recent \
    sbin    davidosomething/git-my \
    sbin atload"export _MENU_THEME=legacy" \
            arzzen/git-quick-stats \
    sbin    iwata/git-now \
    make"PREFIX=$ZPFX install" \
    tj/git-extras

zplugin ice as"program" pick"$ZPFX/bin/git-(url|guclone)" make"install PREFIX=$ZPFX"
zplugin light zdharma-continuum/git-url

zinit ice from"gh-r" as"program"
zinit light junegunn/fzf-bin

#zinit ice \
#    as"completion" \
#    id-as"chezmoi-completion" \
#    has"chezmoi" \
#    atclone"chezmoi completion zsh > _chezmoi" \
#    atpull"%atclone" \
#    nocompile
#zinit light zdharma-continuum/null

zinit ice \
    as"completion" \
    id-as"yq-completion" \
    has"yq" \
    atclone"yq shell-completion zsh > _yq" \
    atpull"%atclone" \
    nocompile
zinit light zdharma-continuum/null

zinit ice wait lucid \
  id-as"vk-kubectl-helpers" \
  nocompile
zinit snippet {{ joinPath .chezmoi.sourceDir "etc/zsh/kubectl-helpers/my-kubectl-functions.zsh" | quote }}

# make'!...' -> run make before atclone & atpull
zinit ice as"program" \
    make'!' \
    atclone'./direnv hook zsh > zhook.zsh' \
    atpull'%atclone' \
    src"zhook.zsh"
zinit light direnv/direnv

autoload -Uz compinit
compinit

zinit cdreplay -q

export EDITOR={{ .editor | quote }}

{{- if index . "tools" }}
{{- if has "sdkman" .tools }}
#THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!
[[ -s "$SDKMAN_DIR/bin/sdkman-init.sh" ]] && source "$SDKMAN_DIR/bin/sdkman-init.sh"
{{- end }}
{{- end }}
